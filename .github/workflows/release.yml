name: ğŸš€ Release Build

on:
  push:
    tags:
      - 'v*.*.*'  # v1.0.0, v1.1.0, v1.0.1 gibi taglar
  workflow_dispatch:  # Manuel tetikleme

jobs:
  build-and-release:
    runs-on: windows-latest
    permissions:
      contents: write

    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4

    - name: ğŸ”§ Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ“¦ Restore Dependencies
      run: dotnet restore KesifUDFGenerator/KesifUDFGenerator.csproj

    - name: ğŸ—ï¸ Build Application
      run: dotnet build KesifUDFGenerator/KesifUDFGenerator.csproj --configuration Release --no-restore
      
    - name: ğŸ“¦ Publish Self-Contained
      run: |
        dotnet publish KesifUDFGenerator/KesifUDFGenerator.csproj --configuration Release --runtime win-x64 --self-contained true --output ./publish -p:PublishSingleFile=true -p:PublishTrimmed=false

    - name: ğŸ“ Create Release Package
      run: |
        $version = "${{ github.ref_name }}"
        $packageName = "KesifMetniOlusturucu-$version-win-x64"

        Copy-Item "./publish/KesifUDFGenerator.exe" "./$packageName.exe"

        if (Test-Path "./publish/appsettings.json") {
          Copy-Item "./publish/appsettings.json" "./appsettings.json"
        }

        Compress-Archive -Path "./$packageName.exe" -DestinationPath "./$packageName.zip"

        echo "PACKAGE_NAME=$packageName" >> $env:GITHUB_ENV
        echo "VERSION=$version" >> $env:GITHUB_ENV
      shell: pwsh
      
    - name: ğŸš€ Create GitHub Release
      uses: softprops/action-gh-release@v2
      with:
        name: "KeÅŸif Metni OluÅŸturucu ${{ github.ref_name }}"
        body: |
          ## ğŸ‰ KeÅŸif Metni OluÅŸturucu ${{ github.ref_name }}

          ### ğŸ“‹ Bu SÃ¼rÃ¼mde:
          - âœ… Modern WPF arayÃ¼zÃ¼
          - âœ… Otomatik keÅŸif metni oluÅŸturma
          - âœ… BilirkiÅŸi tÃ¼rleri yÃ¶netimi
          - âœ… Ãœcret hesaplama sistemi
          - âœ… Metni kopyala butonu geri bildirim Ã¶zelliÄŸi
          - âœ… Ayarlanabilir varsayÄ±lan deÄŸerler

          ### ğŸ’» Sistem Gereksinimleri:
          - Windows 10/11 (x64)
          - .NET Runtime dahil (self-contained)

          ### ğŸ“¦ Kurulum:
          1. Exe dosyasÄ±nÄ± indirin
          2. Ã‡alÄ±ÅŸtÄ±rÄ±n - kurulum gerektirmez!
        files: |
          ${{ env.PACKAGE_NAME }}.exe
          ${{ env.PACKAGE_NAME }}.zip
        draft: false
        prerelease: false
